---
title: soy
description: SQL injection-safe queries from Go types
author: zoobzio
published: 2025-12-30
updated: 2026-01-13
tags:
  - Integrations
  - Database
  - Security
---

# soy

Builds database queries that are structurally safe from SQL injection.

## The Problem

Traditional query builders accept arbitrary strings:

```go
// Field name comes from user input — SQL injection vector
db.Where(userInput + " = ?", value)
```

User input can inject structure, not just values.

## The Pipeline

Define types with database tags:

```go
type User struct {
    ID    int64  `db:"id" constraints:"primarykey"`
    Email string `db:"email" constraints:"unique"`
    Name  string `db:"name"`
}
```

Sentinel extracts the schema:

```go
metadata := sentinel.Inspect[User]()

// metadata.Fields contains:
// - {Name: "ID", Type: "int64", Tags: {"db": "id", "constraints": "primarykey"}}
// - {Name: "Email", Type: "string", Tags: {"db": "email", "constraints": "unique"}}
// - {Name: "Name", Type: "string", Tags: {"db": "name"}}
```

soy builds a validation schema from this metadata. Every query is checked against it:

```go
users, _ := soy.New[User](db, "users")

// Valid: "email" exists in schema
users.Select().Where(soy.C("email", "=", "email"))

// Rejected immediately: "emai" doesn't exist in metadata
users.Select().Where(soy.C("emai", "=", "email"))  // Error: unknown field
```

User input can only provide _values_, never _structure_. The query shape is fixed by your type definition.

## What Sentinel Provides

| soy needs          | Sentinel provides                                           |
| ------------------ | ----------------------------------------------------------- |
| Valid column names | `FieldMetadata.Tags["db"]`                                  |
| Column types       | `FieldMetadata.Type` for type checking                      |
| Primary keys       | `FieldMetadata.Tags["constraints"]` containing `primarykey` |
| Unique constraints | `FieldMetadata.Tags["constraints"]` containing `unique`     |
| Foreign keys       | `FieldMetadata.Tags["references"]`                          |

The metadata becomes the allowlist. Anything not in your struct cannot appear in your query.

## Tag Reference

| Tag           | Purpose            | Example                             |
| ------------- | ------------------ | ----------------------------------- |
| `db`          | Column name        | `db:"user_id"`                      |
| `type`        | SQL type override  | `type:"bigserial"`                  |
| `constraints` | Column constraints | `constraints:"primarykey,not_null"` |
| `references`  | Foreign key        | `references:"users(id)"`            |

## Learn More

- [soy repository](https://github.com/zoobzio/soy)
- [dbml repository](https://github.com/zoobzio/dbml) — schema representation
