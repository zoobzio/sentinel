---
title: Core Concepts
description: Understanding metadata, relationships, and caching in sentinel
author: zoobzio
published: 2025-12-30
updated: 2025-12-30
tags:
  - Concepts
  - Architecture
---

# Core Concepts

## Metadata

Sentinel extracts two levels of metadata:

### Metadata

Represents a complete struct type:

```go
type Metadata struct {
    ReflectType   reflect.Type       // Actual reflect.Type (excluded from JSON)
    FQDN          string             // "github.com/you/app/models.User"
    TypeName      string             // "User"
    PackageName   string             // "github.com/you/app/models"
    Fields        []FieldMetadata    // All exported fields
    Relationships []TypeRelationship // References to other types
}
```

The `FQDN` (Fully Qualified Domain Name) uniquely identifies a type across packages, combining `PackageName` and `TypeName`. This is used as the cache key and in relationship references.

### FieldMetadata

Represents a single struct field:

```go
type FieldMetadata struct {
    ReflectType reflect.Type      // Actual reflect.Type (excluded from JSON)
    Tags        map[string]string // {"json": "email", "validate": "required,email"}
    Name        string            // "Email"
    Type        string            // "string"
    Kind        FieldKind         // "scalar", "pointer", "slice", "struct", "map", "interface"
    Index       []int             // [0] - field index for reflect.FieldByIndex
}
```

**Note:** Only exported fields (capitalised names) are included. Unexported fields are silently skipped, as they cannot be accessed via reflection from outside the package.

The `Kind` field categorizes types for easier conditional logic:

| Kind | Examples |
|------|----------|
| `scalar` | `string`, `int`, `bool`, `float64`, `time.Time` |
| `pointer` | `*User`, `*string` |
| `slice` | `[]Order`, `[5]int` |
| `struct` | `Address`, `Config` |
| `map` | `map[string]int` |
| `interface` | `interface{}`, `io.Reader` |

## Relationships

Sentinel discovers four kinds of relationships between types:

| Kind | Example | Description |
|------|---------|-------------|
| `reference` | `Profile *Profile` | Direct struct or pointer field |
| `collection` | `Orders []Order` | Slice or array of structs |
| `embedding` | `BaseModel` (anonymous) | Embedded struct |
| `map` | `Items map[string]Item` | Map with struct values |

```go
type TypeRelationship struct {
    From      string // Source type FQDN: "github.com/you/app/models.User"
    To        string // Target type FQDN: "github.com/you/app/models.Profile"
    Field     string // Field name: "Profile"
    Kind      string // "reference", "collection", "embedding", "map"
    ToPackage string // Target's package path
}
```

## Caching

Sentinel uses permanent caching because Go types are immutable at runtime:

```go
// First call: extracts metadata (~microseconds)
metadata := sentinel.Inspect[User]()

// Subsequent calls: cache hit (~nanoseconds)
metadata := sentinel.Inspect[User]()
```

### Cache Operations

```go
// List cached type FQDNs
fqdns := sentinel.Browse()

// Lookup by FQDN
meta, ok := sentinel.Lookup("github.com/you/app/models.User")

// Or use the FQDN from previously inspected metadata
userMeta := sentinel.Inspect[User]()
meta, ok := sentinel.Lookup(userMeta.FQDN)

// Export entire cache (keyed by FQDN)
schema := sentinel.Schema()
```

## Module Boundaries

`Scan[T]()` only processes types within your module:

```go
// Your module: github.com/you/app
sentinel.Scan[User]()

// Scans: github.com/you/app/models.User ✓
// Scans: github.com/you/app/types.Profile ✓
// Ignores: github.com/lib/pq.NullString ✗
```

Module detection uses `debug.ReadBuildInfo()` to read your actual module path from `go.mod`.

## Built-in Tags

These tags are extracted by default:

- `json` - JSON field names
- `db` - Database column mappings
- `validate` - Validation rules
- `scope` - Authorization scopes
- `encrypt` - Encryption markers
- `redact` - Redaction hints
- `desc` - Field descriptions
- `example` - Example values

Register additional tags with `sentinel.Tag(name)`.

## Next Steps

- [Architecture](3.architecture.md) — how sentinel works internally
- [Scanning Guide](../3.guides/1.scanning.md) — Inspect vs Scan in depth
